{% load humanize %}
{% load i18n %}

{% for request in batch.download_requests.all %}
  {% with in_error=request.report.first.in_error %}
    <div class="col-md-12 mb-4">
    <div class="card" id="{{ request.id }}">
      {% if in_error %}
        <div class="card-header bg-danger bg-opacity-25">
      {% else %}
        <div class="card-header bg-success bg-opacity-25">
      {% endif %}
      <samp>{{ request.url }}</samp>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col">
            <p>
              {% translate "Creation date:" %} {{ request.created_at }}
            </p>
            {% if in_error %}
              <p>
                <a href="#" data-bs-toggle="modal" data-bs-target="#errorModal-{{ request.id }}">
                  {% translate "See error log" %}
                </a>
              </p>
              {% include "partials/m_modal_error.html" with id=request.id error_message=request.report.first.error_message %}
            {% endif %}
            <span>{% translate "Downloaded content:" %}</span>
            {% include "partials/m_downloaded_contents.html" %}
          </div>
          {% with thumbnail=request.report.first.get_thumbnail %}
            {% if thumbnail and batch_status != "ARCHIVED" %}
              <div class="col-md-2 text-center">
                <div>
                  <img src="{{ thumbnail }}" class="img-fluid rounded-start blurred-image" alt="...">
                </div>
                <div class="mt-2">
                  {% if request.report.first.archive %}
                    <a href="{% url "get_report_archive" request.report.first.id %}" class="btn btn-secondary">
                      <i class="fa fa-download" aria-hidden="true"></i> {% trans "Download archive" %}
                    </a>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endwith %}
        </div>
      </div>
      <div class="card-footer">
        <div class="row">
          <div class="col text-md-end">
            <span>
              {% translate "Status:" %}
              {% if request.status == 'SUCCEEDED' %}
                <span class="badge bg-success">{{ request.get_status_display }}</span>
              {% elif request.status == 'FAILED' %}
                <span class="badge bg-danger">{{ request.get_status_display }}</span>
              {% else %}
                <span class="badge bg-info">{{ request.get_status_display }}</span>
              {% endif %}
              - {% trans "updated" %}
              <span>{{ request.updated_at|naturaltime }}</span>
            </span>
          </div>
        </div>
      </div>
      </div>
    </div>
  {% endwith %}
{% endfor %}
